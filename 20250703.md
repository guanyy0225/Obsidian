好的，这是您提供的23张幻灯片的中文翻译。

---

### **第1页**

**一种针对大规模测序数据中有序性状的高效关联分析策略**

**关媛媛 (Yuanyuan Guan)**

**2025年7月3日**

---

### **第2页**

**现有方法的局限性**

**有序性状的普遍性：**
许多重要性状本质上是有序的。

**现有方法（如 SAIGE-GENE+）的处理方式：**

**视为定量性状处理：**
将有序类别（例如，1, 2, 3, 4, 5）强制转换为等距的定量尺度。这违反了统计学假设，可能导致I类错误率膨胀，即假阳性。

**将性状二元化：**
将多个类别合并为两个（例如，非饮酒者 vs. 饮酒者）。这会丢弃原始数据中丰富的表型信息，从而导致统计功效的损失。

---

### **第3页**

**论文的解决方案 - POLMM-GENE+**

正如 Bi 等人 (2023) 所指出的，他们开发了 POLMM-GENE+ 来解决这个问题。他们的方法基于**比例优势逻辑混合模型 (Proportional Odds Logistic Mixed Model, POLMM)**，该模型可以：

准确地对表型的分类性质进行建模。

使用混合模型框架来校正样本亲缘关系。

通过避免不当数据转换造成的信息损失来保持统计功效。

---

### **第4页**

**我们的解决方案**

---

### **第5页**

**零模型：两阶段分析**

我们的研究建立了一个创新的两阶段分析工作流程。

在第一阶段，我们为有序性状构建一个高质量的零模型，该模型不仅在统计上严谨，而且有效地包含了对**亲缘关系的校正**。

在第二阶段，这个零模型被无缝集成到稀有变异分析工具 STAAR 中，以进行高效的全基因组关联检验。

---

### **第6页**

**零模型：两阶段分析**

```r
fit_null_model <- function(fixed, data, family, id, ...){
  
  is_ordinal <- is.character(family) && family == "ordinal"
  
  if (is_ordinal) {
    # 消息：正在拟合有序回归模型并为 GMMAT/STAAR 做准备...
    message("Fitting an ordinal regression model and preparing for GMMAT/STAAR...") 
    outcome_var_name <- as.character(fixed[[2]])
    
    if (!is.ordered(data[[outcome_var_name]])) {
      # 停止并提示：对于'ordinal'类别，结果变量'...'必须是一个有序因子。
      stop(paste("For 'ordinal' family, the outcome variable '", outcome_var_name, "' must be an ordered factor."))
    }
    
    clm_fit <- ordinal::clm(formula = fixed, data = data, model = TRUE, ...)
    obj_nullmodel <- create_null_from_clm(clm_obj = clm_fit, data = data, id_col = id)
    
  } else {
    # 消息：正在拟合广义线性模型 (如果提供了亲缘关系矩阵，则为 GLMM)...
    message("Fitting a generalized linear model (or GLMM if kins is provided)...")
    obj_nullmodel <- fit_nullmodel(formula, ...)
  }
  
  return(obj_nullmodel)
}

obj.STAAR.UKB.alcohol_intake_frequency <- fit_null_model(
  fixed = null_model_formula,
  data = data_for_null_model,
  family = "ordinal",
  id = "userId"
)
```

---

### **第7页**

**零模型：两阶段分析**

**library(ordinalSTAAR)**

*(这是一个GitHub页面的截图，以下是页面上英文内容的翻译)*

*   **UI 元素:**
    *   Code -> 代码
    *   Issues -> 问题
    *   Pull requests -> 拉取请求
    *   Actions -> 操作
    *   Projects -> 项目
    *   Wiki -> 维基
    *   Security -> 安全
    *   Insights -> 洞察
    *   Settings -> 设置
    *   Public -> 公开
    *   Pin -> 固定
    *   Watch -> 关注
    *   master -> master (分支名)
    *   1 Branch -> 1 分支
    *   0 Tags -> 0 标签
    *   Go to file -> 转到文件
    *   Add file -> 添加文件
    *   Code (按钮) -> 代码
*   **提交信息:**
    *   guanyy0225: Conclude merge after resolving conflicts -> 解决冲突后完成合并
*   **文件列表中的提交描述:**
    *   update fit null model -> 更新fit null model函数
    *   Add S3 method for summary and regenerate documentation -> 为摘要添加S3方法并重新生成文档
    *   Initial commit -> 初始提交
    *   Add GitHub links to DESCRIPTION -> 向DESCRIPTION文件添加GitHub链接

---

### **第8页**

**阶段1(1)：通过累积二分法进行表型二元化**

REGENIE 不支持多分类表型，但它支持多表型分析。

*(图片显示一个数据框，其中原始的有序性状 `alcohol_intake_frequency` 被转换成了多个二元性状，如 `alcohol_bin_1`, `alcohol_bin_2` 等。)*

---

### **第9页**

**阶段1(2)：使用 REGENIE 的多性状模式生成多基因预测**

```bash
conda activate regenie_env
regenie \
  --step 1 \
  --bed /datapool/maths/UKBB/UKB_genotypes_QCed_ZHL/chrall \
  --phenoFile /datapool/home/2024102311/UKB/nullmodels/multiclass/alcohol_intake_frequency/binary \
  --covarFile /datapool/home/2024102311/UKB/nullmodels/multiclass/alcohol_intake_frequency/binary \
  --covarColList sex,age,age2,PC1,PC2,PC3,PC4,PC5,PC6,PC7,PC8,PC9,PC10 \
  --catCovarList sex \
  --bt \
  --bsize 1000 \
  --out /datapool/home/2024102311/UKB/nullmodels/multiclass/alcohol_intake_frequency/binary_regen \
  --threads 8 \
  --print-prs
```

我们利用了 REGENIE 强大的多性状二元模式（--bt）。将生成的5个二元性状在单个表型文件中同时提供。然后，一次性执行 REGENIE 的步骤1，从而高效地并行计算所有5个表型的全基因组、留一染色体排除法（LOCO）预测。

---

### **第10页**

**阶段1(2)：使用 REGENIE 的多性状模式生成多基因预测**

```r
> head(loco_1)[,1:6]
     chr 1000018_1000018 1000020_1000020 1000037_1000037 1000043_1000043
   <int>           <num>           <num>           <num>           <num>
1:     1       -1.007270        0.185582        0.602543       -0.1702980
2:     2       -0.886954        0.370405        0.612409        0.1509350
3:     3       -0.860626        0.106120        0.622462       -0.1060100
4:     4       -0.974894        0.307695        0.769681       -0.0666509
5:     5       -1.026610        0.236088        0.578691        0.0908800
6:     6       -1.009150        0.261516        0.663594       -0.0382941
```

REGENIE 的输出：步骤1为每个二元性状生成了5个独立的 .loco 文件。
每个文件包含22行（对应1-22号染色体）和对应每个样本的列，其中包含了该个体的遗传预测值。

---

### **第11页**

**阶段1(3)：通过主成分分析（PCA）进行降维**

```r
summary(pca_result)
# 成分重要性:
#                        PC1      PC2      PC3      PC4      PC5       PC6       PC7
# 标准差            7.5761   4.6536   3.6488  2.79237  2.27723  0.55381   0.44282
# 方差贡献率         0.5218   0.1969   0.1210  0.07089  0.04714  0.00279   0.00178
# 累积贡献率         0.5218   0.7187   0.8397  0.91059  0.95773  0.96052   0.96230

keep_num <- 5 # 选择5个主成分
pca <- as.data.frame(pca_result$x[, 1:keep_num])
colnames(pca) <- paste0("regenie", 1:keep_num)
head(pca)
#     regenie1    regenie2    regenie3    regenie4    regenie5
# 1 -4.162050   6.430704  11.514053  -3.6421994   4.8328743
# 2 -2.199622  -6.672245  -0.847344  -0.8641354   2.1394649
# 3  6.205353  -5.901825  -5.368471   3.2509371   0.3248081
# 4  8.828008   3.386830   2.679228   3.3951742   2.8530557
# 5 -8.963374  -3.385161   3.306665  -2.1963141  -4.9052987
# 6 20.258823  10.834167   1.791677  -0.3006973  -4.6836191
```

**最终模型公式：酒精摄入量 ~ 年龄 + 性别 + 主成分(1-10) + REGENIE_主成分(1-5)**

---

### **第12页**

**问题：选择 .loco 还是 .prs？**

*(图片显示一个文件列表，包含 .log, .loco, .prs, 和 .list 文件，以及它们的大小和文件类型描述。)*

`binary_regenie_combination.log` 90KB 文本文档
`binary_regenie_combination_1.loco` 110.15MB LOCO 文件
`binary_regenie_combination_1.prs` 11.85MB PRS 文件
`binary_regenie_combination_2.loco` 110.02MB LOCO 文件
`binary_regenie_combination_2.prs` 11.85MB PRS 文件
... (以此类推)

---

### **第13页**

**问题：选择 .loco 还是 .prs？**

**1. .loco 文件：留一染色体排除法 (Leave-One-Chromosome-Out) 预测**

**它是什么：** 当 REGENIE 计算染色体k上某个变异的关联性时，用于校正的多基因背景预测是使用除染色体k以外的所有其他染色体上的SNP构建的。

**目的：避免近端污染 (Proximal Contamination)。**
如果遗传预测包含了与待测变异在同一染色体上的信息，特别是与它处于连锁不平衡（LD）状态的SNP，那么这个协变量本身就会与待测变异相关。这将导致过度校正和统计功效的严重损失。

---

### **第14页**

**问题：选择 .loco 还是 .prs？**

**2. .prs 文件：多基因风险评分 (Polygenic Risk Score)**

**它是什么：** 这个分数是使用全基因组（所有染色体）的SNP为每个个体计算的。它代表了个体对某一性状的总的、全基因组范围的遗传易感性。

**预期用途：**
.prs 文件主要用于下游应用，例如：
*   在独立的數據集中验证PRS模型的预测能力。
*   根据个体的遗传风险对其进行分层。
*   在其他类型的研究中，用作代表整体遗传效应的协变量。

---

### **第15页**

**问题：选择 .loco 还是 .prs？**

**关联检验：**
目标是发现新的基因-性状关联。为确保统计功效，必须使用 **.loco** 预测来避免过度校正。这是我们目前正在做的工作。

**遗传预测：**
目标是构建一个最优模型来预测个体的表型。在这种情况下，应该使用 **.prs** 文件，因为它包含了来自整个基因组的最完整信息。

---

### **第16页**

**阶段2：模型对象的“转换”**

**挑战：**
`ordinal::clm` 函数的输出对象不能被 STAAR 直接使用。

**我们的解决方案（`create_null_from_clm` 函数）：**
步骤1：通过范德瓦尔登正态分数（van der Waerden Normal Scores）进行表型转换；
步骤2：通过结构模拟来复制一个 `glm` 对象。

---

### **第17页**

**阶段2(1)：通过范德瓦尔登正态分数进行表型转换**

**计算条件概率：**
利用已拟合的 `clm` 对象，我们首先计算在给定协变量的条件下，每个个体落入各个有序类别的预测概率。

**应用范德瓦尔登 (VdW) 正态分数：**
然后，我们将有序表型转换为一个连续变量。每个类别的分数是根据其边际概率定义的Z分数分位数，计算在此区间内一个标准正态变量的条件期望值。

**结果：一个新的连续表型**

---

### **第18页**

**阶段2(2)：通过结构模拟来复制一个 glm 对象**

利用新的连续表型，我们构建了一个列表（list）对象，它精确地复制了`glm()`函数返回对象的内部结构。

**决定性步骤：构建 `$qr` 组件**
我们生成了一个标准的、包含截距项的设计矩阵，并使用上一步计算出的权重，对其进行了加权QR分解。

**为何至关重要：** 像 SKAT（STAAR所依赖的包）这样的软件包，其底层的统计机制并不仅仅是简单地对矩阵求逆。为了数值的稳定性和计算效率，它通常直接使用 `glm` 对象的 `$qr` 组件。

```r
# --- 步骤4.5：创建关键的QR分解对象以模拟一个真实的glm对象 ---
message("Step 4.5: Creating the crucial QR decomposition component for compatibility...")
# 像标准GLM一样生成设计矩阵，包含截距项
X_glm <- model.matrix(clm_obj$terms, model_data)
# 执行加权QR分解
qr_obj <- qr(sqrt(weights_squared) * x_glm)
```

---

### **第19页**

**阶段2(2)：通过结构模拟来复制一个 glm 对象**

```r
obj_nullmodel <- list(
  # --- 标准的 GMMAT/STAAR 组件 ---
  id_include       = as.character(sample_ids),
  # theta          = tau,
  n.pheno          = 1,
  n.groups         = 1,
  coefficients     = alpha,
  linear.predictors = eta,
  fitted.values    = mu,
  residuals        = residuals,
  relatedness      = FALSE,
  sparse_kins      = FALSE,
  converged        = clm_obj$convergence$code == 0,

  # --- STAAR 中 GLM 路径的核心组件 ---
  y                = y_numeric,
  weights          = weights_squared,
  family           = gaussian(link = "identity"),

  # --- 为与R的泛型函数兼容所需的关键元数据 ---
  model            = model_data,
  terms            = clm_obj$terms,
  formula          = formula(clm_obj),
  call             = clm_obj$call,

  # --- 基于QR新添加/更新的组件，以增强稳健性 ---
  qr               = qr_obj,
  rank             = qr_obj$rank,
  df.residual      = n_obs - qr_obj$rank,
  cov              = chol2inv(qr_obj$qr)
)
```

---

### **第20页**

**关联分析**

---

### **第21页**

**以基因为中心的编码区关联分析**

```r
analysis_tasks <- data.frame(
  chr = c(4, 4, 4, 4, 4, 4, 4),
  gene_name = c("ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C"),
  category = c("plof_ds", "disruptive_missense", "ptv", "synonymous", "plof", "ptv_ds", "missense")
)
```

| Gene name | Chr | Category | #SNV | cMAC | ACAT-O | STAAR-O |
| :--- | :-: | :--- | :-: | :-: | :--- | :--- |
| ADH1C | 4 | missense | 248 | 4364 | 0.307737957 | 0.307737957 |
| ADH1C | 4 | plof | 16 | 9459 | 8.92E-10 | 8.92E-10 |
| ADH1C | 4 | plof_ds | 16 | 9459 | 8.92E-10 | 8.92E-10 |
| ADH1C | 4 | ptv | 21 | 9578 | 1.13E-09 | 1.13E-09 |
| ADH1C | 4 | ptv_ds | 21 | 9578 | 1.13E-09 | 1.13E-09 |
| ADH1C | 4 | synonymous | 117 | 12856 | 0.603835266 | 0.603835266 |

---

### **第22页**

**以基因为中心的非编码区关联分析**

```r
analysis_tasks <- data.frame(
  chr = c(4, 4, 4, 4, 4, 4, 4),
  gene_name = c("ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C", "ADH1C"),
  category = c("downstream", "upstream", "UTR", "promoter_CAGE", "promoter_DHS", "enhancer_CAGE", "enhancer_DHS")
)
```

| Gene name | Chr | Category | #SNV | cMAC | ACAT-O | STAAR-O |
| :--- | :-: | :--- | :-: | :-: | :--- | :--- |
| ADH1C | 4 | UTR | 141 | 3824 | 0.458242976 | 0.458242976 |
| ADH1C | 4 | upstream | 416 | 10071 | 0.435306925 | 0.435306925 |
| ADH1C | 4 | enhancer_DHS | 1464 | 33036 | 0.112111778 | 0.112111778 |
| ADH1C | 4 | enhancer_CAGE | 137 | 3179 | 0.241962825 | 0.241962825 |

---

### **第23页**

**未来方向**

**(左侧内容)**

**主要研究发现 (UK Biobank 应用)**
作者将POLMM-GENE应用于UK Biobank 45万外显子组测序数据，分析了五个有序分类表型：
1.  饮酒频率 (Alcohol intake frequency)
2.  10岁时相对身高 (Comparative height size at age 10)
3.  10岁时相对体型 (Comparative body size at age 10)
4.  睡眠类型/时型 (Morning/evening person chronotype)
5.  认知症状严重程度 (Cognitive symptoms severity)

*   总共发现了54个显著的基因-表型关联 (p < 2.5 x 10⁻⁶)。
*   **主要发现亮点 (Table 1 & Figure 3):**
    *   **饮酒频率：** 确认了已知基因 ADH1C 的关联，并发现了一个新的潜在关联基因 GIGYF1。
    *   **睡眠类型：** 再次验证了生物钟核心基因 PER2 和 PER3 以及褪黑素受体基因 MTNR1B 的强关联。
    *   **10岁时相对身高：** 发现了大量与身高和生长发育相关的基因，如 ACAN, NPR2, GH1 等，其中许多是已知的人类身高相关基因，验证了方法的可靠性。同时，也发现了一些新的关联。
    *   **认知症状严重程度：** 发现了一个有趣的关联基因 MRGPRX1，该基因与感知（如瘙痒、疼痛）有关，这为认知功能与感觉通路之间的联系提供了新的线索。

**(右侧列表)**

1.  **零模型列表 (Null Model List)**
2.  **SPA** (Saddlepoint Approximation, 鞍点近似法)
3.  **BOLT-LMM 和 fastGWA**
4.  **ACAT** (Association-analysis of Complex Traits, 复杂性状关联分析)